{% extends "base.html" %}

{% block title %}Doctor Profile - E-Vura{% endblock %}

{% block content %}
<!-- Header -->
<div style="background: white; border-radius: 15px; padding: 30px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center;">
    <div style="width: 120px; height: 120px; border-radius: 50%; background: #0ea5e9; display: flex; align-items: center; justify-content: center; font-size: 48px; color: white; font-weight: bold; margin: 0 auto 20px;">
        <i class="fas fa-user-md"></i>
    </div>
    <h1 style="font-size: 28px; margin-bottom: 10px;">Dr. {{ doctor.username }}</h1>
    <p style="color: #6b7280;">Manage your professional information and credentials</p>
</div>

<form method="POST" action="{{ url_for('doctor_profile') }}">
    <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
        <h3 style="color: #111827; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f3f4f6;">
            <i class="fas fa-id-badge"></i> Professional Information
        </h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="form-group">
                <label>Name</label>
                <input type="text" value="Dr. {{ doctor.username }}" disabled style="background: #f9fafb; color: #6b7280;">
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" value="{{ doctor.email }}" disabled style="background: #f9fafb; color: #6b7280;">
            </div>

            <div class="form-group">
                <label><i class="fas fa-phone"></i> Phone Number</label>
                <input type="tel" name="phone" value="{{ doctor.phone or '' }}" placeholder="+250 XXX XXX XXX">
            </div>

            <div class="form-group">
                <label><i class="fas fa-stethoscope"></i> Specialization</label>
                <select name="specialization">
                    <option value="">Select specialization...</option>
                    <option value="General Practice" {% if doctor.specialization == 'General Practice' %}selected{% endif %}>General Practice</option>
                    <option value="Internal Medicine" {% if doctor.specialization == 'Internal Medicine' %}selected{% endif %}>Internal Medicine</option>
                    <option value="Pediatrics" {% if doctor.specialization == 'Pediatrics' %}selected{% endif %}>Pediatrics</option>
                    <option value="Cardiology" {% if doctor.specialization == 'Cardiology' %}selected{% endif %}>Cardiology</option>
                    <option value="Dermatology" {% if doctor.specialization == 'Dermatology' %}selected{% endif %}>Dermatology</option>
                    <option value="Orthopedics" {% if doctor.specialization == 'Orthopedics' %}selected{% endif %}>Orthopedics</option>
                    <option value="Gynecology" {% if doctor.specialization == 'Gynecology' %}selected{% endif %}>Gynecology</option>
                    <option value="Psychiatry" {% if doctor.specialization == 'Psychiatry' %}selected{% endif %}>Psychiatry</option>
                    <option value="Surgery" {% if doctor.specialization == 'Surgery' %}selected{% endif %}>Surgery</option>
                    <option value="Emergency Medicine" {% if doctor.specialization == 'Emergency Medicine' %}selected{% endif %}>Emergency Medicine</option>
                    <option value="Other" {% if doctor.specialization == 'Other' %}selected{% endif %}>Other</option>
                </select>
            </div>

            <div class="form-group">
                <label><i class="fas fa-hospital"></i> Hospital/Clinic</label>
                <input type="text" name="hospital" value="{{ doctor.hospital or '' }}" placeholder="Hospital or clinic name">
            </div>

            <div class="form-group">
                <label><i class="fas fa-calendar"></i> Years of Experience</label>
                <input type="number" name="years_experience" value="{{ doctor.years_experience or '' }}" placeholder="Years" min="0" max="50">
            </div>

            <div class="form-group" style="grid-column: 1 / -1;">
                <label><i class="fas fa-id-card"></i> Medical License Number</label>
                <input type="text" value="{{ doctor.license_number or 'Not provided' }}" disabled style="background: #f9fafb; color: #6b7280;">
                <small style="color: #6b7280; font-style: italic; margin-top: 5px; display: block;">
                    License information cannot be changed here. Contact support for updates.
                </small>
            </div>
        </div>
    </div>

    <!-- Professional Benefits Info -->
    <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
        <h4 style="color: #1e40af; margin-bottom: 15px;"><i class="fas fa-star"></i> E-Vura Doctor Benefits</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div>
                <h5 style="color: #1d4ed8; margin-bottom: 8px;">üìã Complete Patient Context</h5>
                <p style="color: #1e40af; font-size: 14px; margin: 0; line-height: 1.5;">
                    Access full medical histories and chronic condition alerts for every patient.
                </p>
            </div>
            <div>
                <h5 style="color: #1d4ed8; margin-bottom: 8px;">‚ö° Instant Notifications</h5>
                <p style="color: #1e40af; font-size: 14px; margin: 0; line-height: 1.5;">
                    Receive email alerts for new appointments with patient health summaries.
                </p>
            </div>
            <div>
                <h5 style="color: #1d4ed8; margin-bottom: 8px;">üè• Better Care Quality</h5>
                <p style="color: #1e40af; font-size: 14px; margin: 0; line-height: 1.5;">
                    Provide superior care with complete patient medical timelines.
                </p>
            </div>
        </div>
    </div>

    <!-- Save Button -->
    <div style="display: flex; gap: 15px; margin-bottom: 30px;">
        <button type="submit" class="btn btn-primary" style="flex: 1; padding: 15px; font-size: 16px;">
            <i class="fas fa-save"></i> Update Profile
        </button>
        <a href="{{ url_for('doctor_dashboard') }}" class="btn btn-secondary" style="padding: 15px; font-size: 16px;">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</form>

<!-- Professional Statistics -->
<div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
    <h3 style="color: #111827; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f3f4f6;">
        <i class="fas fa-chart-bar"></i> Your Professional Statistics
    </h3>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
        <div style="text-align: center; padding: 20px; background: #f0fdfa; border-radius: 10px; border-left: 4px solid #10b981;">
            <div style="font-size: 32px; font-weight: bold; color: #10b981; margin-bottom: 5px;">
                {% set total_patients = namespace() %}
                {% set total_patients.count = 0 %}
                {% for apt in doctor.appointments %}
                    {% set unique_patients = doctor.appointments|map(attribute='patient_id')|list|unique|list %}
                    {{ unique_patients|length }}
                {% endfor %}
                {{ total_patients.count }}
            </div>
            <div style="color: #065f46; font-size: 14px;">Total Patients</div>
        </div>
        
        <div style="text-align: center; padding: 20px; background: #eff6ff; border-radius: 10px; border-left: 4px solid #3b82f6;">
            <div style="font-size: 32px; font-weight: bold; color: #3b82f6; margin-bottom: 5px;">{{ doctor.appointments|length }}</div>
            <div style="color: #1e40af; font-size: 14px;">Total Appointments</div>
        </div>
        
        <div style="text-align: center; padding: 20px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #0d9488;">
            <div style="font-size: 32px; font-weight: bold; color: #0d9488; margin-bottom: 5px;">{{ doctor.appointments|selectattr('status', 'equalto', 'completed')|list|length }}</div>
            <div style="color: #0f766e; font-size: 14px;">Completed Consultations</div>
        </div>
        
        <div style="text-align: center; padding: 20px; background: #fffbeb; border-radius: 10px; border-left: 4px solid #f59e0b;">
            <div style="font-size: 32px; font-weight: bold; color: #f59e0b; margin-bottom: 5px;">{{ doctor.years_experience or 0 }}</div>
            <div style="color: #92400e; font-size: 14px;">Years Experience</div>
        </div>
    </div>
</div>

<!-- Platform Information -->
<div style="background: #f0fdfa; border-left: 4px solid #0d9488; padding: 20px; border-radius: 10px;">
    <h4 style="color: #065f46; margin-bottom: 15px;"><i class="fas fa-lightbulb"></i> Making Healthcare Better in Rwanda</h4>
    <p style="color: #047857; line-height: 1.6; margin: 0;">
        As an E-Vura healthcare provider, you're part of a revolutionary platform that ensures <strong>no patient loses their medical history</strong> when changing doctors or hospitals. 
        Your access to complete patient timelines, including chronic conditions and past treatments, enables you to provide superior care 
        and make informed medical decisions from the very first consultation.
    </p>
</div>
{% endblock %}